<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Café Reservas - Sistema de Reserva de Mesas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style id="app-style">
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8f5f2;
      color: #4a4a4a;
    }
    
    h1, h2, h3, h4 {
      font-family: 'Playfair Display', serif;
    }
    
    .cafe-btn {
      background-color: #6b4f3d;
      color: white;
      transition: all 0.3s ease;
    }
    
    .cafe-btn:hover {
      background-color: #896a57;
      transform: translateY(-2px);
    }
    
    .cafe-btn-outline {
      border: 2px solid #6b4f3d;
      color: #6b4f3d;
      transition: all 0.3s ease;
    }
    
    .cafe-btn-outline:hover {
      background-color: #6b4f3d;
      color: white;
    }
    
    .cafe-card {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }
    
    .cafe-card:hover {
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
    }
    
    .table-card {
      border: 2px solid #e0e0e0;
      transition: all 0.2s ease;
    }
    
    .table-card:hover {
      border-color: #6b4f3d;
    }
    
    .table-card.selected {
      border-color: #6b4f3d;
      background-color: #f3ece6;
    }
    
    .auth-container {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.9) 100%);
      backdrop-filter: blur(10px);
    }
    
    /* Animation classes */
    .fade-in {
      animation: fadeIn 0.4s ease-in-out forwards;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Calendar styles */
    .calendar-day {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border-radius: 50%;
      transition: all 0.2s ease;
    }
    
    .calendar-day:hover {
      background-color: #f3ece6;
    }
    
    .calendar-day.selected {
      background-color: #6b4f3d;
      color: white;
    }
    
    .calendar-day.disabled {
      color: #d1d1d1;
      cursor: not-allowed;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .calendar-container {
        grid-template-columns: repeat(7, 1fr);
      }
      
      .calendar-day {
        width: 35px;
        height: 35px;
      }
    }
    
    .time-slot {
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .time-slot:hover {
      background-color: #f3ece6;
    }
    
    .time-slot.selected {
      background-color: #6b4f3d;
      color: white;
    }
    
    .time-slot.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <!-- Header Navigation -->
  <nav id="main-nav" class="hidden py-4 px-6 bg-white shadow-sm">
    <div class="container mx-auto flex justify-between items-center">
      <div class="flex items-center">
        <h1 class="text-2xl font-bold text-[#6b4f3d]">Café Reservas</h1>
      </div>
      
      <div class="flex items-center space-x-4">
        <span id="user-name" class="hidden md:inline-block font-medium"></span>
        <button id="logout-btn" class="cafe-btn-outline px-4 py-2 rounded-lg text-sm">
          <i class="fas fa-sign-out-alt mr-2"></i>Cerrar Sesión
        </button>
      </div>
    </div>
  </nav>

  <!-- Main Content Container -->
  <div class="container mx-auto px-4 py-8">
    
    <!-- Login/Register View -->
    <div id="auth-view" class="min-h-[80vh] flex items-center justify-center">
      <div class="auth-container cafe-card p-8 w-full max-w-md">
        <div class="text-center mb-8">
          <h1 class="text-3xl font-bold text-[#6b4f3d] mb-2">Café Reservas</h1>
          <p class="text-gray-600">Sistema de reserva de mesas</p>
        </div>
        
        <div class="mb-6">
          <label for="email" class="block text-sm font-medium mb-2">Correo Electrónico</label>
          <input type="email" id="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#6b4f3d]" placeholder="tucorreo@ejemplo.com">
        </div>
        
        <div class="mb-6">
          <label for="password" class="block text-sm font-medium mb-2">Contraseña</label>
          <input type="password" id="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#6b4f3d]" placeholder="••••••••">
        </div>
        
        <div class="mb-6">
          <label for="role" class="block text-sm font-medium mb-2">Acceder como</label>
          <select id="role" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#6b4f3d]">
            <option value="client">Cliente</option>
            <option value="admin">Administrador</option>
          </select>
        </div>
        
        <button id="login-btn" class="cafe-btn w-full py-3 rounded-lg font-medium mb-4">
          Iniciar Sesión
        </button>
        
        <p class="text-center text-sm text-gray-600">
          ¿No tienes una cuenta? <a href="javascript:void(0)" id="toggle-register" class="text-[#6b4f3d] font-medium">Regístrate</a>
        </p>
      </div>
    </div>
    
    <!-- Client View - Calendar and Time Selection -->
    <div id="client-reservation-view" class="hidden">
      <div class="mb-8">
        <h2 class="text-2xl font-bold mb-6">Reserva tu mesa</h2>
        
        <!-- Steps indicator -->
        <div class="flex items-center mb-8">
          <div id="step-1-indicator" class="flex flex-col items-center">
            <div class="w-8 h-8 bg-[#6b4f3d] text-white rounded-full flex items-center justify-center">1</div>
            <span class="text-sm mt-1">Fecha y hora</span>
          </div>
          <div class="h-[2px] bg-gray-300 w-16 md:w-24"></div>
          <div id="step-2-indicator" class="flex flex-col items-center opacity-50">
            <div class="w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center">2</div>
            <span class="text-sm mt-1">Seleccionar mesa</span>
          </div>
          <div class="h-[2px] bg-gray-300 w-16 md:w-24"></div>
          <div id="step-3-indicator" class="flex flex-col items-center opacity-50">
            <div class="w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center">3</div>
            <span class="text-sm mt-1">Confirmar</span>
          </div>
        </div>
        
        <!-- Step 1: Calendar and Time Selection -->
        <div id="step-1" class="cafe-card p-6">
          <h3 class="text-xl font-semibold mb-4">Selecciona fecha y hora</h3>
          
          <!-- Month selector -->
          <div class="flex justify-between items-center mb-4">
            <button id="prev-month" class="p-2 text-[#6b4f3d]"><i class="fas fa-chevron-left"></i></button>
            <h4 id="current-month" class="text-lg font-medium"></h4>
            <button id="next-month" class="p-2 text-[#6b4f3d]"><i class="fas fa-chevron-right"></i></button>
          </div>
          
          <!-- Days of week -->
          <div class="grid grid-cols-7 text-center mb-2">
            <div class="font-medium text-sm text-gray-500">L</div>
            <div class="font-medium text-sm text-gray-500">M</div>
            <div class="font-medium text-sm text-gray-500">M</div>
            <div class="font-medium text-sm text-gray-500">J</div>
            <div class="font-medium text-sm text-gray-500">V</div>
            <div class="font-medium text-sm text-gray-500">S</div>
            <div class="font-medium text-sm text-gray-500">D</div>
          </div>
          
          <!-- Calendar days grid -->
          <div id="calendar-days" class="grid grid-cols-7 gap-1 mb-6">
            <!-- Calendar days will be populated by JavaScript -->
          </div>
          
          <!-- Time selection -->
          <div id="time-selection" class="mt-6">
            <h4 class="text-lg font-medium mb-3">Horario disponible:</h4>
            <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2">
              <div class="time-slot text-center py-2 px-1 border rounded-lg">10:00</div>
              <div class="time-slot text-center py-2 px-1 border rounded-lg">11:00</div>
              <div class="time-slot text-center py-2 px-1 border rounded-lg">12:00</div>
              <div class="time-slot text-center py-2 px-1 border rounded-lg">13:00</div>
              <div class="time-slot text-center py-2 px-1 border rounded-lg">14:00</div>
              <div class="time-slot text-center py-2 px-1 border rounded-lg">15:00</div>
              <div class="time-slot text-center py-2 px-1 border rounded-lg">16:00</div>
              <div class="time-slot text-center py-2 px-1 border rounded-lg">17:00</div>
              <div class="time-slot text-center py-2 px-1 border rounded-lg">18:00</div>
              <div class="time-slot text-center py-2 px-1 border rounded-lg">19:00</div>
              <div class="time-slot text-center py-2 px-1 border rounded-lg">20:00</div>
              <div class="time-slot text-center py-2 px-1 border rounded-lg">21:00</div>
            </div>
          </div>
          
          <div class="mt-8 flex justify-end">
            <button id="continue-to-tables" class="cafe-btn px-6 py-3 rounded-lg" disabled>
              Continuar <i class="fas fa-arrow-right ml-2"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Step 2: Table Selection -->
    <div id="step-2" class="hidden cafe-card p-6">
      <h3 class="text-xl font-semibold mb-4">Selecciona una mesa</h3>
      
      <div class="mb-6">
        <label for="guests" class="block text-sm font-medium mb-2">Número de comensales</label>
        <select id="guests" class="w-full md:w-1/3 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#6b4f3d]">
          <option value="1">1 persona</option>
          <option value="2" selected>2 personas</option>
          <option value="3">3 personas</option>
          <option value="4">4 personas</option>
          <option value="5">5 personas</option>
          <option value="6">6 personas</option>
          <option value="7">7 personas</option>
          <option value="8">8 personas</option>
        </select>
      </div>
      
      <div class="mb-6">
        <h4 class="font-medium mb-3">Mesas disponibles para <span id="selected-date-time">fecha y hora seleccionada</span>:</h4>
        
        <div id="tables-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          <!-- Table cards will be populated by JavaScript -->
          <div class="table-card p-4 rounded-lg text-center cursor-pointer" data-table-id="1">
            <div class="w-16 h-16 mx-auto mb-2 bg-[#f3ece6] rounded-lg flex items-center justify-center">
              <i class="fas fa-coffee text-2xl text-[#6b4f3d]"></i>
            </div>
            <h5 class="font-semibold">Mesa 1</h5>
            <p class="text-sm text-gray-600">Capacidad: 2 personas</p>
          </div>
          
          <div class="table-card p-4 rounded-lg text-center cursor-pointer" data-table-id="2">
            <div class="w-16 h-16 mx-auto mb-2 bg-[#f3ece6] rounded-lg flex items-center justify-center">
              <i class="fas fa-coffee text-2xl text-[#6b4f3d]"></i>
            </div>
            <h5 class="font-semibold">Mesa 2</h5>
            <p class="text-sm text-gray-600">Capacidad: 4 personas</p>
          </div>
          
          <div class="table-card p-4 rounded-lg text-center cursor-pointer" data-table-id="3">
            <div class="w-16 h-16 mx-auto mb-2 bg-[#f3ece6] rounded-lg flex items-center justify-center">
              <i class="fas fa-coffee text-2xl text-[#6b4f3d]"></i>
            </div>
            <h5 class="font-semibold">Mesa 3</h5>
            <p class="text-sm text-gray-600">Capacidad: 4 personas</p>
          </div>
          
          <div class="table-card p-4 rounded-lg text-center cursor-pointer" data-table-id="4">
            <div class="w-16 h-16 mx-auto mb-2 bg-[#f3ece6] rounded-lg flex items-center justify-center">
              <i class="fas fa-coffee text-2xl text-[#6b4f3d]"></i>
            </div>
            <h5 class="font-semibold">Mesa 4</h5>
            <p class="text-sm text-gray-600">Capacidad: 6 personas</p>
          </div>
        </div>
      </div>
      
      <div class="mt-8 flex justify-between">
        <button id="back-to-calendar" class="cafe-btn-outline px-6 py-3 rounded-lg">
          <i class="fas fa-arrow-left mr-2"></i> Volver
        </button>
        <button id="continue-to-confirm" class="cafe-btn px-6 py-3 rounded-lg" disabled>
          Continuar <i class="fas fa-arrow-right ml-2"></i>
        </button>
      </div>
    </div>
    
    <!-- Step 3: Confirmation -->
    <div id="step-3" class="hidden cafe-card p-6">
      <h3 class="text-xl font-semibold mb-4">Confirmar reserva</h3>
      
      <div class="bg-[#f3ece6] p-4 rounded-lg mb-6">
        <h4 class="font-medium mb-2">Detalles de la reserva:</h4>
        <ul class="space-y-2">
          <li><strong>Fecha:</strong> <span id="confirm-date"></span></li>
          <li><strong>Hora:</strong> <span id="confirm-time"></span></li>
          <li><strong>Mesa:</strong> <span id="confirm-table"></span></li>
          <li><strong>Comensales:</strong> <span id="confirm-guests"></span></li>
        </ul>
      </div>
      
      <div class="mb-6">
        <label for="notes" class="block text-sm font-medium mb-2">Notas adicionales (opcional)</label>
        <textarea id="notes" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#6b4f3d]" rows="3" placeholder="Si tienes alguna solicitud especial, indícala aquí..."></textarea>
      </div>
      
      <div class="mt-8 flex justify-between">
        <button id="back-to-tables" class="cafe-btn-outline px-6 py-3 rounded-lg">
          <i class="fas fa-arrow-left mr-2"></i> Volver
        </button>
        <button id="submit-reservation" class="cafe-btn px-6 py-3 rounded-lg">
          Confirmar Reserva <i class="fas fa-check ml-2"></i>
        </button>
      </div>
    </div>
    
    <!-- Success Message -->
    <div id="success-message" class="hidden text-center py-8">
      <div class="cafe-card p-8 max-w-lg mx-auto">
        <div class="w-20 h-20 mx-auto mb-4 bg-green-100 rounded-full flex items-center justify-center">
          <i class="fas fa-check text-3xl text-green-500"></i>
        </div>
        <h3 class="text-xl font-bold mb-2">¡Reserva confirmada!</h3>
        <p class="text-gray-600 mb-6">Hemos enviado un correo electrónico con los detalles de tu reserva a tu dirección de email.</p>
        
        <div class="bg-[#f3ece6] p-4 rounded-lg mb-6 text-left">
          <h4 class="font-medium mb-2">Detalles de la reserva:</h4>
          <ul class="space-y-2">
            <li><strong>Número de reserva:</strong> <span id="reservation-id">R-2504-1234</span></li>
            <li><strong>Fecha:</strong> <span id="success-date">12 de abril, 2025</span></li>
            <li><strong>Hora:</strong> <span id="success-time">19:00</span></li>
            <li><strong>Mesa:</strong> <span id="success-table">Mesa 3</span></li>
            <li><strong>Comensales:</strong> <span id="success-guests">4 personas</span></li>
          </ul>
        </div>
        
        <button id="cancel-reservation" class="cafe-btn-outline px-6 py-3 rounded-lg mr-4">
          <i class="fas fa-times mr-2"></i> Cancelar Reserva
        </button>
        <button id="new-reservation" class="cafe-btn px-6 py-3 rounded-lg">
          <i class="fas fa-plus mr-2"></i> Nueva Reserva
        </button>
      </div>
    </div>
    
    <!-- Admin View -->
    <div id="admin-view" class="hidden">
      <div class="mb-8">
        <h2 class="text-2xl font-bold mb-6">Panel de Administración</h2>
        
        <div class="cafe-card p-6">
          <div class="flex flex-col md:flex-row justify-between md:items-center mb-6">
            <h3 class="text-xl font-semibold mb-4 md:mb-0">Reservas</h3>
            
            <!-- Filters -->
            <div class="flex flex-col sm:flex-row gap-4">
              <div class="flex-1">
                <label for="filter-date" class="block text-sm font-medium mb-1">Filtrar por fecha</label>
                <input type="date" id="filter-date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#6b4f3d]">
              </div>
              <div class="flex-1">
                <label for="filter-status" class="block text-sm font-medium mb-1">Estado</label>
                <select id="filter-status" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#6b4f3d]">
                  <option value="all">Todas</option>
                  <option value="active">Activas</option>
                  <option value="cancelled">Canceladas</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Reservations Table -->
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="border-b-2 border-gray-200">
                  <th class="px-4 py-2 text-left">#</th>
                  <th class="px-4 py-2 text-left">Cliente</th>
                  <th class="px-4 py-2 text-left">Fecha</th>
                  <th class="px-4 py-2 text-left">Hora</th>
                  <th class="px-4 py-2 text-left">Mesa</th>
                  <th class="px-4 py-2 text-left">Comensales</th>
                  <th class="px-4 py-2 text-left">Estado</th>
                  <th class="px-4 py-2 text-left">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                  <td class="px-4 py-3">R-1001</td>
                  <td class="px-4 py-3">Maria González</td>
                  <td class="px-4 py-3">12/04/2025</td>
                  <td class="px-4 py-3">19:00</td>
                  <td class="px-4 py-3">Mesa 3</td>
                  <td class="px-4 py-3">4</td>
                  <td class="px-4 py-3"><span class="inline-block px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">Activa</span></td>
                  <td class="px-4 py-3">
                    <button class="text-red-500 hover:text-red-700" title="Cancelar Reserva">
                      <i class="fas fa-times"></i>
                    </button>
                  </td>
                </tr>
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                  <td class="px-4 py-3">R-1002</td>
                  <td class="px-4 py-3">Carlos Sánchez</td>
                  <td class="px-4 py-3">12/04/2025</td>
                  <td class="px-4 py-3">20:00</td>
                  <td class="px-4 py-3">Mesa 2</td>
                  <td class="px-4 py-3">2</td>
                  <td class="px-4 py-3"><span class="inline-block px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">Activa</span></td>
                  <td class="px-4 py-3">
                    <button class="text-red-500 hover:text-red-700" title="Cancelar Reserva">
                      <i class="fas fa-times"></i>
                    </button>
                  </td>
                </tr>
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                  <td class="px-4 py-3">R-1003</td>
                  <td class="px-4 py-3">Laura Martínez</td>
                  <td class="px-4 py-3">13/04/2025</td>
                  <td class="px-4 py-3">13:00</td>
                  <td class="px-4 py-3">Mesa 1</td>
                  <td class="px-4 py-3">2</td>
                  <td class="px-4 py-3"><span class="inline-block px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs">Cancelada</span></td>
                  <td class="px-4 py-3">
                    <button class="text-gray-400 cursor-not-allowed" disabled title="Reserva cancelada">
                      <i class="fas fa-times"></i>
                    </button>
                  </td>
                </tr>
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                  <td class="px-4 py-3">R-1004</td>
                  <td class="px-4 py-3">Javier López</td>
                  <td class="px-4 py-3">14/04/2025</td>
                  <td class="px-4 py-3">18:00</td>
                  <td class="px-4 py-3">Mesa 4</td>
                  <td class="px-4 py-3">6</td>
                  <td class="px-4 py-3"><span class="inline-block px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">Activa</span></td>
                  <td class="px-4 py-3">
                    <button class="text-red-500 hover:text-red-700" title="Cancelar Reserva">
                      <i class="fas fa-times"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Pagination -->
          <div class="flex justify-between items-center mt-6">
            <div class="text-sm text-gray-600">Mostrando 1-4 de 4 reservas</div>
            <div class="flex space-x-1">
              <button class="px-3 py-1 border border-gray-300 rounded-lg text-sm bg-gray-100">1</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Cancel Confirmation Modal -->
    <div id="cancel-modal" class="hidden fixed inset-0 z-50 overflow-auto bg-black bg-opacity-50 flex items-center justify-center">
      <div class="cafe-card p-6 max-w-md mx-auto">
        <h3 class="text-xl font-semibold mb-4">¿Cancelar reserva?</h3>
        <p class="text-gray-600 mb-6">¿Estás seguro de que deseas cancelar esta reserva? Esta acción no se puede deshacer.</p>
        
        <div class="flex justify-end space-x-4">
          <button id="cancel-modal-close" class="cafe-btn-outline px-4 py-2 rounded-lg">No, mantener</button>
          <button id="confirm-cancel" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg">Sí, cancelar</button>
        </div>
      </div>
    </div>
    
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  
  <script id="app-script">
    // App State
    const state = {
        currentView: 'auth', // auth, client, admin
        currentStep: 1,
        selectedDate: null,
        selectedTime: null,
        selectedTable: null,
        selectedGuests: 2,
        user: null
    };

    // DOM Elements
    const views = {
        auth: document.getElementById('auth-view'),
        client: document.getElementById('client-reservation-view'),
        admin: document.getElementById('admin-view'),
        step1: document.getElementById('step-1'),
        step2: document.getElementById('step-2'),
        step3: document.getElementById('step-3'),
        success: document.getElementById('success-message'),
        nav: document.getElementById('main-nav'),
        cancelModal: document.getElementById('cancel-modal')
    };

    // Buttons and Interactive Elements
    const elements = {
        loginBtn: document.getElementById('login-btn'),
        logoutBtn: document.getElementById('logout-btn'),
        continueToTablesBtn: document.getElementById('continue-to-tables'),
        backToCalendarBtn: document.getElementById('back-to-calendar'),
        continueToConfirmBtn: document.getElementById('continue-to-confirm'),
        backToTablesBtn: document.getElementById('back-to-tables'),
        submitReservationBtn: document.getElementById('submit-reservation'),
        cancelReservationBtn: document.getElementById('cancel-reservation'),
        newReservationBtn: document.getElementById('new-reservation'),
        cancelModalCloseBtn: document.getElementById('cancel-modal-close'),
        confirmCancelBtn: document.getElementById('confirm-cancel'),
        userName: document.getElementById('user-name'),
        roleSelect: document.getElementById('role'),
        emailInput: document.getElementById('email'),
        passwordInput: document.getElementById('password'),
        guestsSelect: document.getElementById('guests'),
        calendarDays: document.getElementById('calendar-days'),
        timeSlots: document.querySelectorAll('.time-slot'),
        tableCards: document.querySelectorAll('.table-card'),
        prevMonthBtn: document.getElementById('prev-month'),
        nextMonthBtn: document.getElementById('next-month'),
        currentMonthText: document.getElementById('current-month'),
        selectedDateTimeText: document.getElementById('selected-date-time'),
        confirmDateText: document.getElementById('confirm-date'),
        confirmTimeText: document.getElementById('confirm-time'),
        confirmTableText: document.getElementById('confirm-table'),
        confirmGuestsText: document.getElementById('confirm-guests'),
        successDateText: document.getElementById('success-date'),
        successTimeText: document.getElementById('success-time'),
        successTableText: document.getElementById('success-table'),
        successGuestsText: document.getElementById('success-guests'),
        toggleRegisterBtn: document.getElementById('toggle-register')
    };
    function obtenerDatosReserva() {
    const fecha = document.getElementById('confirm-date').textContent;
    const hora = document.getElementById('confirm-time').textContent;
    const mesa = state.selectedTable; // Usamos el estado ya guardado
    const comensales = state.selectedGuests; // Usamos el estado ya guardado

    const datosReserva = {
      Fecha: fecha, // Ajustamos los nombres de las claves para que coincidan con Python
      Hora: hora,   // Ajustamos los nombres de las claves para que coincidan con Python
      Id_mesa: mesa, // Ajustamos los nombres de las claves para que coincidan con Python
      comensales: comensales
    };

    const jsonData = JSON.stringify(datosReserva); // Convierte el objeto a formato JSON
    return jsonData;
  }

  // -------------------- Función para enviar los datos de la reserva a Python (vía AJAX) --------------------
  function enviarDatosReservaAPython() {
    const jsonData = obtenerDatosReserva();

    $.ajax({
      method: 'POST',
      url: '/agregar_reserva', // La URL del endpoint en tu servidor Python
      dataType: 'json',       // Espera una respuesta en formato JSON
      contentType: 'application/json', // Envía los datos en formato JSON
      data: jsonData,
      success: function(data) {
        console.log('Respuesta del servidor (reserva):', data);
        if (data === '{"guardado"}') { // Comprobamos la respuesta exacta del servidor
          alert('¡Reserva confirmada con éxito!');
          views.step1.classList.add('hidden');
          views.step2.classList.add('hidden');
          views.step3.classList.add('hidden');
          views.success.classList.remove('hidden');
        } else if (data === '{"datooooooooos"}') {
          alert('Por favor, asegúrese de completar todos los detalles de la reserva.');
        } else if (data === '{"mensaje de alerta ultima"}') {
          alert('Hubo un problema al guardar la reserva. Por favor, inténtelo de nuevo.');
        } else if (data === '{"error al conectar database"}') {
          alert('No se pudo conectar con la base de datos. Por favor, inténtelo más tarde.');
        } else if (data === '{"erroe en aklgo"}') {
          alert('Ocurrió un error inesperado al procesar su reserva.');
        } else if (data.error) { // Para manejar posibles errores en formato JSON
          alert('Error al confirmar la reserva: ' + data.error);
        }
      },
      error: function(jqXHR, textStatus, errorThrown) {
        console.error('Error al enviar los datos de la reserva:', textStatus, errorThrown);
        alert('Error de conexión al intentar confirmar la reserva.');
      }
    });
  }

    // Event Listeners
    function initEventListeners() {
        // Authentication
        elements.loginBtn.addEventListener('click', handleLogin);
        elements.logoutBtn.addEventListener('click', handleLogout);

        // Navigation between steps
        elements.continueToTablesBtn.addEventListener('click', () => goToStep(2));
        elements.backToCalendarBtn.addEventListener('click', () => goToStep(1));
        elements.continueToConfirmBtn.addEventListener('click', () => goToStep(3));
        elements.backToTablesBtn.addEventListener('click', () => goToStep(2));

        // Submit reservation
        elements.submitReservationBtn.addEventListener('click', handleSubmitReservation);
        elements.submitReservationBtn.addEventListener('click', enviarDatosReservaAPython);

        // Enviar reserva a Python
        if (elements.confirmarEnviarReservaBtn) {
            elements.confirmarEnviarReservaBtn.addEventListener('click', enviarDatosReservaAPython);
        } else {
            console.warn("El botón 'confirmarEnviarReservaBtn' no se encontró en el DOM.");
        }

        // After success
        elements.cancelReservationBtn.addEventListener('click', showCancelModal);
        elements.newReservationBtn.addEventListener('click', startNewReservation);

        // Cancel modal
        elements.cancelModalCloseBtn.addEventListener('click', hideCancelModal);
        elements.confirmCancelBtn.addEventListener('click', handleCancelReservation);

        // Calendar navigation
        elements.prevMonthBtn.addEventListener('click', () => navigateMonth(-1));
        elements.nextMonthBtn.addEventListener('click', () => navigateMonth(1));

        // Select guests
        elements.guestsSelect.addEventListener('change', updateAvailableTables);

        // Time slots selection
        elements.timeSlots.forEach(slot => {
            slot.addEventListener('click', () => {
                if (!slot.classList.contains('disabled')) {
                    selectTimeSlot(slot);
                }
            });
        });

        // Table selection
        elements.tableCards.forEach(card => {
            card.addEventListener('click', () => {
                selectTable(card);
            });
        });

        // Toggle register form
        elements.toggleRegisterBtn.addEventListener('click', toggleRegisterForm);
    }

    // View Management Functions
    function showView(viewName) {
        // Hide all views
        Object.values(views).forEach(view => {
            if (view) view.classList.add('hidden');
        });

        // Show the requested view
        if (views[viewName]) {
            views[viewName].classList.remove('hidden');
            views.nav.classList.remove('hidden');
        }

        state.currentView = viewName;
    }

    function goToStep(step) {
        // Hide all steps
        views.step1.classList.add('hidden');
        views.step2.classList.add('hidden');
        views.step3.classList.add('hidden');

        // Show the current step
        if (step === 1) views.step1.classList.remove('hidden');
        if (step === 2) views.step2.classList.remove('hidden');
        if (step === 3) {
            views.step3.classList.remove('hidden');
            updateConfirmationDetails();
        }

        // Update step indicators
        document.querySelectorAll('#step-1-indicator, #step-2-indicator, #step-3-indicator').forEach((indicator, index) => {
            if (index + 1 <= step) {
                indicator.classList.remove('opacity-50');
                indicator.querySelector('div').classList.remove('bg-gray-300', 'text-gray-600');
                indicator.querySelector('div').classList.add('bg-[#6b4f3d]', 'text-white');
            } else {
                indicator.classList.add('opacity-50');
                indicator.querySelector('div').classList.add('bg-gray-300', 'text-gray-600');
                indicator.querySelector('div').classList.remove('bg-[#6b4f3d]', 'text-white');
            }
        });

        state.currentStep = step;
    }

    // Authentication Functions
    // Authentication Functions
    function handleLogin() {
    const email = $('#email').val();
    const password = $('#password').val();

    const userData = {
        correo: email,
        clave: password
    };

    $.ajax({
        method: 'POST',
        url: '/agregar_cliente',
        dataType: 'json', // Esperamos una respuesta JSON (para errores)
        contentType: 'application/json',
        data: JSON.stringify(userData),
        beforeSend: function() {
            // Opcional: Mostrar un indicador de carga
        },
        success: function(data, textStatus, jqXHR) {
            // La solicitud AJAX fue exitosa.
            console.log('Respuesta del servidor:', data);

            // Si el servidor devolvió un JSON con un mensaje de éxito (esto sería una ALTERNATIVA a la redirección del servidor)
            if (data.mensaje === 'Guardado exitosamente') {
                state.user = {
                    email: email,
                    name: email.split('@')[0], // Simulación de nombre
                };
                showView('client');
                goToStep(1);
                populateCalendar();
                alert("SE GUARDO CORRECTAMENTE");
                elements.userName.textContent = state.user.name;
            } else if (data.error) {
                // Si el servidor devolvió un JSON con un error
                alert('Error: ' + data.error);
            } else {
                // Si llegamos aquí y no hay 'mensaje' de éxito ni 'error' en el JSON,
                // podríamos intentar una redirección basada en la respuesta HTTP.
                // Sin embargo, es más confiable que el SERVIDOR envíe la URL de redirección.
                console.warn('Respuesta inesperada del servidor:', data);
            }
        },
        error: function(jqXHR, textStatus, errorThrown) {
            // La solicitud AJAX falló.
            console.error('Error en la solicitud:', textStatus, errorThrown);
            alert('Error en la comunicación con el servidor.');
        }
    });
}
  function handleLogout() {
    state.user = null;
    showView('auth');
    }


    function toggleRegisterForm() {
        const isLoginMode = elements.toggleRegisterBtn.textContent === 'Regístrate';

        if (isLoginMode) {
            elements.toggleRegisterBtn.textContent = 'Iniciar sesión';
            elements.loginBtn.textContent = 'Registrarse';
        } else {
            elements.toggleRegisterBtn.textContent = 'Regístrate';
            elements.loginBtn.textContent = 'Iniciar Sesión';
        }
    }

    // Calendar Functions
    function populateCalendar() {
        const now = new Date();
        const year = now.getFullYear();
        const month = now.getMonth();

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);

        // Update month display
        const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
        elements.currentMonthText.textContent = `${monthNames[month]} ${year}`;

        // Clear previous calendar
        elements.calendarDays.innerHTML = '';

        // Add empty cells for days before the first day of the month
        let firstDayOfWeek = firstDay.getDay();
        if (firstDayOfWeek === 0) firstDayOfWeek = 7; // Sunday is 0, but we want Monday as 1

        for (let i = 1; i < firstDayOfWeek; i++) {
            const emptyCell = document.createElement('div');
            elements.calendarDays.appendChild(emptyCell);
        }

        // Add days of the month
        for (let day = 1; day <= lastDay.getDate(); day++) {
            const dayCell = document.createElement('div');
            dayCell.classList.add('calendar-day');

            const currentDate = new Date(year, month, day);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            if (currentDate < today) {
                dayCell.classList.add('disabled');
            } else {
                dayCell.addEventListener('click', () => selectDate(currentDate));
            }

            dayCell.textContent = day;
            elements.calendarDays.appendChild(dayCell);
        }
    }

    function navigateMonth(change) {
        const currentDate = new Date();

        if (elements.currentMonthText.textContent) {
            const [monthName, year] = elements.currentMonthText.textContent.split(' ');
            const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            const monthIndex = monthNames.indexOf(monthName);

            if (monthIndex !== -1) {
                currentDate.setFullYear(parseInt(year));
                currentDate.setMonth(monthIndex + change);
            }
        }

        const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
        elements.currentMonthText.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;

        populateCalendar();
    }

    function selectDate(date) {
        state.selectedDate = date;

        // Update calendar UI
        document.querySelectorAll('.calendar-day').forEach(day => {
            day.classList.remove('selected');
        });

        event.currentTarget.classList.add('selected');

        // Update continue button state
        updateContinueButtonState();
    }

    function selectTimeSlot(slot) {
        state.selectedTime = slot.textContent;

        // Update UI
        elements.timeSlots.forEach(timeSlot => {
            timeSlot.classList.remove('selected');
        });

        slot.classList.add('selected');

        // Update continue button state
        updateContinueButtonState();
    }

    function updateContinueButtonState() {
        if (state.selectedDate && state.selectedTime) {
            elements.continueToTablesBtn.disabled = false;
            elements.continueToTablesBtn.classList.remove('opacity-50');
        } else {
            elements.continueToTablesBtn.disabled = true;
            elements.continueToTablesBtn.classList.add('opacity-50');
        }
    }

    // Table Selection Functions
    function updateAvailableTables() {
        state.selectedGuests = parseInt(elements.guestsSelect.value);

        // In a real app, this would filter tables based on capacity
        // For the prototype, we'll just update the UI
        elements.tableCards.forEach(card => {
            const capacity = parseInt(card.querySelector('p').textContent.match(/\d+/)[0]);

            if (capacity < state.selectedGuests) {
                card.classList.add('opacity-50');
                card.classList.add('cursor-not-allowed');
                card.classList.remove('cursor-pointer');
            } else {
                card.classList.remove('opacity-50');
                card.classList.remove('cursor-not-allowed');
                card.classList.add('cursor-pointer');
            }
        });

        // Update selected date/time display
        if (state.selectedDate && state.selectedTime) {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = state.selectedDate.toLocaleDateString('es-ES', options);
            elements.selectedDateTimeText.textContent = `${formattedDate}, ${state.selectedTime}`;
        }
    }

    function selectTable(tableCard) {
        const capacity = parseInt(tableCard.querySelector('p').textContent.match(/\d+/)[0]);

        if (capacity < state.selectedGuests) {
            // Table doesn't have enough capacity
            return;
        }

        state.selectedTable = tableCard.querySelector('h5').textContent;

        // Update UI
        elements.tableCards.forEach(card => {
            card.classList.remove('selected');
        });

        tableCard.classList.add('selected');

        // Enable continue button
        elements.continueToConfirmBtn.disabled = false;
        elements.continueToConfirmBtn.classList.remove('opacity-50');
    }
    

    // Reservation Functions
    function updateConfirmationDetails() {
        if (state.selectedDate && state.selectedTime && state.selectedTable) {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = state.selectedDate.toLocaleDateString('es-ES', options);

            elements.confirmDateText.textContent = formattedDate;
            elements.confirmTimeText.textContent = state.selectedTime;
            elements.confirmTableText.textContent = state.selectedTable;
            elements.confirmGuestsText.textContent = `${state.selectedGuests} ${state.selectedGuests === 1 ? 'persona' : 'personas'}`;
        }
    }

    function handleSubmitReservation() {
        // In a real app, this would send the data to the server
        // For the prototype, we'll just show the success message

        // Copy confirmation details to success screen
        elements.successDateText.textContent = elements.confirmDateText.textContent;
        elements.successTimeText.textContent = elements.confirmTimeText.textContent;
        elements.successTableText.textContent = elements.confirmTableText.textContent;
        elements.successGuestsText.textContent = elements.confirmGuestsText.textContent;

        // Hide steps and show success
        views.step1.classList.add('hidden');
        views.step2.classList.add('hidden');
        views.step3.classList.add('hidden');
        views.success.classList.remove('hidden');
    }

    function startNewReservation() {
        // Reset state
        state.selectedDate = null;
        state.selectedTime = null;
        state.selectedTable = null;

        // Reset UI
        document.querySelectorAll('.calendar-day').forEach(day => {
            day.classList.remove('selected');
        });

        elements.timeSlots.forEach(slot => {
            slot.classList.remove('selected');
        });

        elements.tableCards.forEach(card => {
            card.classList.remove('selected');
        });

        // Disable continue buttons
        elements.continueToTablesBtn.disabled = true;
        elements.continueToTablesBtn.classList.add('opacity-50');

        elements.continueToConfirmBtn.disabled = true;
        elements.continueToConfirmBtn.classList.add('opacity-50');

        // Show step 1
        views.success.classList.add('hidden');
        goToStep(1);
    }

    // Cancel Modal Functions
    function showCancelModal() {
        views.cancelModal.classList.remove('hidden');
    }

    function hideCancelModal() {
        views.cancelModal.classList.add('hidden');
    }

    function handleCancelReservation() {
        // In a real app, this would send a cancellation request to the server
        // For the prototype, we'll just show a message and go back to step 1
        hideCancelModal();
        alert('Tu reserva ha sido cancelada con éxito.');
        startNewReservation();
    }

    // Initialize the app
    function init() {
        initEventListeners();

        // Start in auth view
        showView('auth');

        // For development purposes, could auto-login:
        // handleLogin();
    }

    // Run the app
    init();
    document.addEventListener('DOMContentLoaded', function() {
    const prevMonthButton = document.getElementById('prev-month');
    const nextMonthButton = document.getElementById('next-month');
    const currentMonthDisplay = document.getElementById('current-month');
    const calendarDaysContainer = document.getElementById('calendar-days');

    let currentDate = new Date();

    function updateCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const firstDayOfMonth = new Date(year, month, 1);
        const lastDayOfMonth = new Date(year, month + 1, 0);
        const daysInMonth = lastDayOfMonth.getDate();
        const firstDayOfWeek = firstDayOfMonth.getDay(); // 0 para Domingo, 1 para Lunes, etc.

        const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
            "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
        ];
        currentMonthDisplay.textContent = `${monthNames[month]} ${year}`;

        calendarDaysContainer.innerHTML = ''; // Limpiar los días anteriores

        // Agregar espacios en blanco al principio para alinear el primer día
        for (let i = 0; i < firstDayOfWeek; i++) {
            const emptyDiv = document.createElement('div');
            calendarDaysContainer.appendChild(emptyDiv);
        }

        // Generar los días del mes
        for (let day = 1; day <= daysInMonth; day++) {
            const dayButton = document.createElement('button');
            dayButton.textContent = day;
            dayButton.classList.add('w-10', 'h-10', 'flex', 'items-center', 'justify-center', 'rounded-full', 'text-sm');
            dayButton.addEventListener('click', function() {
                // Aquí puedes agregar la lógica para seleccionar la fecha
                alert(`Fecha seleccionada: ${day}/${month + 1}/${year}`);
            });
            calendarDaysContainer.appendChild(dayButton);
        }
    }

    prevMonthButton.addEventListener('click', function() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        updateCalendar();
    });

    nextMonthButton.addEventListener('click', function() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        updateCalendar();
    });

    updateCalendar(); 
});

  </script>
  <script>
    
  </script>
</body>
</html>